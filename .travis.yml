language: c

compiler: gcc

env:
  - CROSS=
  - CROSS=pb

before_install: if [ "$CROSS" = pb ]; then git clone https://github.com/pocketbook-free/SDK_481.git ; fi

install: make

before_script: touch empty-theme.cfg

script:
    - if [ -z "$CROSS" ]; then ./pbtheme -h ; fi
    
    - if [ -z "$CROSS" ]; then ./pbtheme test-env/Line.pbt theme.cfg ; fi
    - if [ -z "$CROSS" ]; then test "`stat -c %s theme.cfg`" = 227394 ; fi
  
    - if [ -z "$CROSS" ]; then ./pbtheme -p test-env/Line.pbt theme.cfg ; fi
    - if [ -z "$CROSS" ]; then test "`stat -c %s test-env/Line.pbt`" = 520290 ; fi

    - if [ -z "$CROSS" ]; then ./pbtheme -u test-env/Line.pbt > new-theme.cfg ; fi
    - if [ -z "$CROSS" ]; then diff new-theme.cfg theme.cfg ; fi
  
    - if [ -z "$CROSS" ]; then ./pbtheme -p test-env/Line.pbt empty-theme.cfg ; fi
    - if [ -z "$CROSS" ]; then test "`stat -c %s test-env/Line.pbt`" = 494527 ; fi

deploy:
  provider: releases
  api_key: "ba169a1d791b2a6349d79285ab3a0d171bb04fdf"
  file: "pbtheme"
  skip_cleanup: true
  on:
    condition: $CROSS = pb
    tags: true

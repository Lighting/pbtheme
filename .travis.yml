language: c

compiler: gcc

addons:
  apt:
    packages: mingw32

cache:
  directories: .success

env:
#  - CROSS=
#  - CROSS=pb
  - CROSS=win

before_install:
  - if [ "$CROSS" = pb ]; then git clone https://github.com/pocketbook-free/SDK_481.git ; fi
  - if [ "$CROSS" = win ]; then wget http://sourceforge.net/projects/libpng/files/zlib/1.2.8/zlib-1.2.8.tar.gz ; fi
  - if [ "$CROSS" = win ]; then tar xvzf zlib-1.2.8.tar.gz ; fi
  - if [ "$CROSS" = win ]; then make -f zlib-1.2.8/win32/Makefile.gcc BINARY_PATH=/usr/local/bin INCLUDE_PATH=/usr/local/include LIBRARY_PATH=/usr/local/lib install ; fi

install: make

before_script: touch empty-theme.cfg

script:
  - if [ -z "$CROSS" ]; then ./pbtheme -h ; fi
    
  - if [ -z "$CROSS" ]; then ./pbtheme test-env/Line.pbt theme.cfg ; fi
  - if [ -z "$CROSS" ]; then test "`stat -c %s theme.cfg`" = 227394 ; fi
  
  - if [ -z "$CROSS" ]; then ./pbtheme -p test-env/Line.pbt theme.cfg ; fi
  - if [ -z "$CROSS" ]; then test "`stat -c %s test-env/Line.pbt`" = 520290 ; fi

  - if [ -z "$CROSS" ]; then ./pbtheme -u test-env/Line.pbt > new-theme.cfg ; fi
  - if [ -z "$CROSS" ]; then diff new-theme.cfg theme.cfg ; fi
  
  - if [ -z "$CROSS" ]; then ./pbtheme -p test-env/Line.pbt empty-theme.cfg ; fi
  - if [ -z "$CROSS" ]; then test "`stat -c %s test-env/Line.pbt`" = 494527 ; fi

after_success: if [ -z "$CROSS" ]; then touch .success ; fi

after_failure: rm -f .success

#deploy:
#  provider: releases
#  api_key: secure: "uhEDBNIy1iBEn5SisBAu2zAl+SedGIJBG5VlgqcuFNPexGV88Z5EGnTUamRwZ8nB5MD9RQzoHjJHbA5IHEe1dfH4r2O4BA9VpLkhFG8LbzGA44AOwfm8MYmdeXagxHFYUkGkDC2TW7jwh9iJXjmmDYw2OAhRB7ywr1YrxIhQuLeroW/UNshwHLUiZDN
#MMxW/5IT7Neu+PyAjxP8N/h+ZeRIKM9eJ8EJX6JuXYeXgAt9j4GODLW2/PTm+GNrlwpy0+/b2G85wMb8Q3i/rm96JyO1m3ronKGCD8upxbcFLAEyLmvWFLeC5axNz8QtdjK9EMLXcKhT73Hc55WzNOebiKr4/plOK2r9BxvVoPfVfWsZWVsYY7QxyKipYvq1+EyTht
#JeUeJHo2uBf2roV+oKkVnVWkDOJYKP8gfT5knBrcEEmnIoZnKW8DukJ7xlVY6YBdF962TPOkSfqIJTvAYLjRYuPP1zMfYqIKaWz+kVc3cMrJCp8SoNRohYbLvPSC6aTxGdMrqmr2fNuQt1ux41inCtJuOBleEElf9PntVuse1FWscQl3fqbWi2ILT0d+DnmZBEIyrh
#1i39OOwIDnMTdjzOkZjONj9I0Ka4lAEoto4okMMuTi2AL2NDa0ZQkVbtVxIMC7U399Kwb1647J/1CA3WaKdoaaEk9WqbeaMf5tWw="
#  file: "pbtheme"
#  skip_cleanup: true
#  on:
#    condition: $CROSS = pb 
#    condition: [ -e .success ]
#    tags: true
